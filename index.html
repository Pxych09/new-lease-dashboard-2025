<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PB - Lease Management Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
  <h1 class="text-2xl font-bold text-sky-900 mb-4">PB - Lease Management Dashboard</h1>
  <p class="text-sky-700 mb-6">Fetching sheet data... check your browser console üëá</p>

  <script>
    // API URL (Apps Script Web App endpoint)
    const API_URL = 'https://script.google.com/macros/s/AKfycbx9BnScZXouEciOLKTy2Qs9FOx7gYvWXTb_XdmZqguehD4sUZmSjFLfsn75rIO9KGLBIQ/exec';

    // Sheets you want to fetch
    const REQUIRED_SHEETS = ['Actives', 'Verified', 'Contract Signed', 'Approved', 'Pending', 'Terminated'];

    // Storage for final results
    let allSheetsData = {};

    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ App initialized');
      fetchAllSheets();
    });

    // Main function: fetch all sheet data
    async function fetchAllSheets() {
      try {
        console.log('üì° Fetching available sheets...');
        const sheetListResponse = await fetch(API_URL);
        const sheetListData = await sheetListResponse.json();

        if (!sheetListData.success) {
          throw new Error(sheetListData.message || 'Failed to get sheet list');
        }

        console.log('‚úÖ Available sheets:', sheetListData.sheetNames);

        // Check missing sheets
        const missing = REQUIRED_SHEETS.filter(s => !sheetListData.sheetNames.includes(s));
        if (missing.length) {
          throw new Error(`Missing sheets: ${missing.join(', ')}`);
        }

        console.log('‚úÖ All required sheets found, now fetching data...');

        // Fetch each sheet and structure results
        for (const sheetName of REQUIRED_SHEETS) {
          const rawData = await fetchSheetData(sheetName);

          if (rawData.length > 0) {
            const headers = rawData[0];
            const rows = rawData.slice(1).filter(r => r.some(c => String(c).trim() !== ''));
            allSheetsData[sheetName] = {
              headers,
              rows,
              count: rows.length
            };
          } else {
            allSheetsData[sheetName] = { headers: [], rows: [], count: 0 };
          }
        }

        console.log('üéâ All sheets fetched successfully!');
        console.log('üìä Structured Data:', allSheetsData);

      } catch (err) {
        console.error('‚ùå Error fetching sheets:', err.message);
      }
    }

    // Fetch single sheet
    async function fetchSheetData(sheetName) {
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sheetName })
        });

        const json = await res.json();
        if (!json.success) {
          console.error(`‚ö†Ô∏è Failed to fetch ${sheetName}:`, json.error);
          return [];
        }
        return json.data;
      } catch (err) {
        console.error(`‚ùå Error fetching ${sheetName}:`, err.message);
        return [];
      }
    }
  </script>
</body>
</html>
